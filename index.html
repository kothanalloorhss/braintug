<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Brain Tug: Arena</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âš¡</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gray: { 900: '#0f172a', 800: '#1e293b', 700: '#334155' },
                        accent: '#22c55e',
                        danger: '#ef4444',
                        p1: '#3b82f6',
                        p2: '#f97316',
                    },
                    animation: {
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'bounce-short': 'bounce 0.5s infinite',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        #rope-marker { transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .frozen-overlay { background: rgba(0, 180, 255, 0.2); backdrop-filter: blur(2px); }
        body { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; }
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen overflow-hidden flex flex-col font-sans touch-manipulation">

    <audio id="bgm" loop><source src="assets/bgm.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-correct"><source src="assets/correct.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-wrong"><source src="assets/wrong.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-win"><source src="assets/win.mp3" type="audio/mpeg"></audio>

    <button onclick="toggleMute()" id="btn-mute" class="fixed top-4 right-4 z-[100] bg-gray-800 p-3 rounded-full border border-gray-600 hover:bg-gray-700 transition">
    <i class="fas fa-volume-up text-white" id="icon-mute"></i>
</button>

    <div id="screen-menu" class="screen flex flex-col items-center justify-center h-full w-full p-4 space-y-8 absolute inset-0 bg-gray-900 z-50">
        <h1 class="text-5xl md:text-8xl font-black uppercase tracking-tighter text-transparent bg-clip-text bg-gradient-to-br from-p1 to-p2 drop-shadow-lg text-center">
            Brain Tug
        </h1>
        
        <div class="flex gap-4 bg-gray-800 p-2 rounded-xl">
            <button onclick="setGameType('math')" id="btn-math" class="px-4 py-2 rounded-lg font-bold bg-blue-600 text-white ring-2 ring-blue-400">
                <i class="fas fa-calculator mr-2"></i>Math
            </button>
            <button onclick="setGameType('english')" id="btn-eng" class="px-4 py-2 rounded-lg font-bold text-gray-400 hover:text-white">
                <i class="fas fa-book mr-2"></i>English
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-xl">
            <button onclick="setupQuickPlay()" class="bg-gray-800 hover:bg-gray-700 p-6 rounded-2xl border-2 border-gray-700">
                <h3 class="text-xl font-bold text-accent mb-1">Quick Play</h3>
                <p class="text-gray-400 text-xs">1v1 Battle</p>
            </button>
            <button onclick="setupTournament()" class="bg-gray-800 hover:bg-gray-700 p-6 rounded-2xl border-2 border-gray-700">
                <h3 class="text-xl font-bold text-purple-400 mb-1">Tournament</h3>
                <p class="text-gray-400 text-xs">Bracket System</p>
            </button>
        </div>
        
        <div id="controls-hint" class="text-gray-500 text-xs mt-8 bg-gray-800 px-4 py-2 rounded border border-gray-700 text-center">
            <p class="hidden lg:block"><strong>PC:</strong> P1 (Top Row) vs P2 (Numpad)</p>
            <p class="lg:hidden"><strong>Tablet/Mobile:</strong> Use On-Screen Keypads</p>
        </div>
    </div>

    <div id="screen-quick-setup" class="screen hidden flex-col items-center justify-center h-full w-full absolute inset-0 bg-gray-900 z-50">
        <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl w-full max-w-md border border-gray-700 m-4">
            <h2 class="text-2xl font-bold mb-6 text-center">Challengers</h2>
            <input id="qp-p1" type="text" placeholder="Player 1 Name" class="w-full bg-gray-900 border border-gray-600 p-3 rounded mb-4 text-p1 font-bold focus:border-p1 outline-none">
            <input id="qp-p2" type="text" placeholder="Player 2 Name" class="w-full bg-gray-900 border border-gray-600 p-3 rounded mb-6 text-p2 font-bold focus:border-p2 outline-none">
            <div class="flex gap-4">
                <button onclick="showScreen('screen-menu')" class="flex-1 py-3 bg-gray-700 rounded font-bold">Back</button>
                <button onclick="startQuickGame()" class="flex-1 py-3 bg-accent rounded font-bold text-black">Start</button>
            </div>
        </div>
    </div>

    <div id="screen-tourney-setup" class="screen hidden flex-col items-center h-full w-full p-4 absolute inset-0 bg-gray-900 z-50">
        <h2 class="text-2xl font-bold mb-4 text-purple-400 mt-4">Registry</h2>
        <div class="flex w-full max-w-xl gap-2 mb-4">
            <input id="tourney-input" type="text" placeholder="Name..." class="flex-1 bg-gray-800 border border-gray-600 p-3 rounded-lg outline-none focus:border-purple-500">
            <button onclick="addTourneyPlayer()" class="px-6 bg-purple-600 hover:bg-purple-500 rounded-lg font-bold"><i class="fas fa-plus"></i></button>
        </div>
        <ul id="tourney-list" class="w-full max-w-xl flex-1 bg-gray-800 rounded-xl p-4 overflow-y-auto mb-4 border border-gray-700 space-y-2"></ul>
        <div class="flex gap-4 w-full max-w-xl">
            <button onclick="showScreen('screen-menu')" class="px-6 py-3 bg-gray-700 rounded-lg font-bold">Back</button>
            <button onclick="generateFixture()" id="btn-start-tourney" class="flex-1 bg-green-500 hover:bg-green-400 text-black font-bold rounded-lg hidden">GO!</button>
        </div>
    </div>

    <div id="screen-tourney-hub" class="screen hidden flex-col h-full w-full p-4 absolute inset-0 bg-gray-900 z-50">
        <header class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-purple-400">Bracket</h2>
            <button onclick="quitTournament()" class="text-red-400 text-xs uppercase border border-red-900 px-2 py-1 rounded">Exit</button>
        </header>
        <div class="flex-1 flex flex-col lg:flex-row gap-4 overflow-hidden">
            <div class="flex-1 bg-gray-800 rounded-xl p-4 overflow-y-auto border border-gray-700" id="bracket-view"></div>
            <div class="h-1/3 lg:h-auto lg:w-80 flex flex-col gap-4">
                <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 flex-1 flex flex-col justify-center text-center">
                    <div id="next-match-card"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-game" class="screen hidden h-full w-full flex-col relative bg-gray-900 absolute inset-0 z-40">
        
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-30 pointer-events-none">
            <div class="bg-black/80 px-4 py-2 rounded-full border border-gray-600 backdrop-blur">
                <span id="game-timer" class="text-2xl font-mono font-bold text-white">60</span>
            </div>
        </div>

        <div class="flex-1 flex flex-col lg:flex-row relative h-full">
            
            <div id="zone-p1" class="flex-1 border-b lg:border-b-0 lg:border-r border-gray-700 flex flex-col items-center justify-between p-4 relative transition-colors duration-200 transform rotate-180 lg:rotate-0">
                
                <div class="w-full flex justify-between items-center opacity-80">
                    <div class="text-left">
                        <h3 id="game-p1-name" class="text-lg font-bold text-p1">P1</h3>
                        <div id="combo-p1" class="text-yellow-400 text-xs font-bold hidden"><i class="fas fa-fire"></i> COMBO</div>
                    </div>
                    <span class="text-p1 font-bold text-2xl" id="score-p1">0</span>
                </div>

                <div class="flex-1 flex flex-col justify-center items-center w-full">
                    <div id="q-p1-text" class="text-4xl lg:text-5xl font-black text-white mb-2">...</div>
                    <div id="q-p1-opts" class="grid grid-cols-3 gap-2 text-sm text-gray-400 font-mono hidden w-full max-w-xs"></div>
                    <div id="input-p1" class="text-5xl font-mono text-p1 border-b-4 border-gray-700 min-h-[60px] min-w-[100px] text-center mt-4"></div>
                    <div id="feedback-p1" class="h-6 mt-2 font-bold text-lg"></div>
                </div>

                <div id="frozen-p1" class="absolute inset-0 frozen-overlay hidden flex items-center justify-center z-20 rounded-lg">
                    <i class="fas fa-snowflake text-6xl text-blue-300 animate-bounce"></i>
                </div>

                <div class="lg:hidden w-full max-w-sm grid grid-cols-3 gap-2 mt-2 mx-auto">
                    <button onclick="handleInstantInput('p1', '1')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">1</button>
                    <button onclick="handleInstantInput('p1', '2')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">2</button>
                    <button onclick="handleInstantInput('p1', '3')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">3</button>
                    <button onclick="handleInstantInput('p1', '4')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">4</button>
                    <button onclick="handleInstantInput('p1', '5')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">5</button>
                    <button onclick="handleInstantInput('p1', '6')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">6</button>
                    <button onclick="handleInstantInput('p1', '7')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">7</button>
                    <button onclick="handleInstantInput('p1', '8')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">8</button>
                    <button onclick="handleInstantInput('p1', '9')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">9</button>
                    <button onclick="clearInput('p1')" class="bg-gray-700 p-3 rounded text-lg font-bold text-red-400">DEL</button>
                    <button onclick="handleInstantInput('p1', '0')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p1">0</button>
                </div>
            </div>

            <div class="absolute inset-x-0 top-1/2 h-1 lg:inset-y-0 lg:left-1/2 lg:w-1 bg-gray-600 z-10 overflow-visible flex items-center justify-center pointer-events-none">
                <div id="rope-marker" class="w-12 h-12 lg:w-16 lg:h-16 bg-yellow-500 rounded-full border-4 border-gray-900 z-20 flex items-center justify-center shadow-2xl">
                    <i class="fas fa-grip-lines lg:rotate-90 text-black opacity-50 text-xl"></i>
                </div>
            </div>

            <div id="zone-p2" class="flex-1 flex flex-col items-center justify-between p-4 relative transition-colors duration-200">
                <div class="w-full flex justify-between items-center opacity-80">
                    <span class="text-p2 font-bold text-2xl" id="score-p2">0</span>
                    <div class="text-right">
                        <h3 id="game-p2-name" class="text-lg font-bold text-p2">P2</h3>
                        <div id="combo-p2" class="text-yellow-400 text-xs font-bold hidden"><i class="fas fa-fire"></i> COMBO</div>
                    </div>
                </div>

                <div class="flex-1 flex flex-col justify-center items-center w-full">
                    <div id="q-p2-text" class="text-4xl lg:text-5xl font-black text-white mb-2">...</div>
                    <div id="q-p2-opts" class="grid grid-cols-3 gap-2 text-sm text-gray-400 font-mono hidden w-full max-w-xs"></div>
                    <div id="input-p2" class="text-5xl font-mono text-p2 border-b-4 border-gray-700 min-h-[60px] min-w-[100px] text-center mt-4"></div>
                    <div id="feedback-p2" class="h-6 mt-2 font-bold text-lg"></div>
                </div>

                <div id="frozen-p2" class="absolute inset-0 frozen-overlay hidden flex items-center justify-center z-20 rounded-lg">
                    <i class="fas fa-snowflake text-6xl text-blue-300 animate-bounce"></i>
                </div>

                <div class="lg:hidden w-full max-w-sm grid grid-cols-3 gap-2 mt-2 mx-auto">
                    <button onclick="handleInstantInput('p2', '1')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">1</button>
                    <button onclick="handleInstantInput('p2', '2')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">2</button>
                    <button onclick="handleInstantInput('p2', '3')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">3</button>
                    <button onclick="handleInstantInput('p2', '4')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">4</button>
                    <button onclick="handleInstantInput('p2', '5')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">5</button>
                    <button onclick="handleInstantInput('p2', '6')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">6</button>
                    <button onclick="handleInstantInput('p2', '7')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">7</button>
                    <button onclick="handleInstantInput('p2', '8')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">8</button>
                    <button onclick="handleInstantInput('p2', '9')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">9</button>
                    <button onclick="clearInput('p2')" class="bg-gray-700 p-3 rounded text-lg font-bold text-red-400">DEL</button>
                    <button onclick="handleInstantInput('p2', '0')" class="bg-gray-800 p-3 rounded text-xl font-bold active:bg-p2">0</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/90 z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-gray-800 p-6 rounded-2xl max-w-sm w-full text-center border border-gray-600 shadow-2xl">
            <h2 id="modal-title" class="text-3xl font-bold mb-2 text-white">Winner!</h2>
            <p id="modal-msg" class="text-gray-400 mb-6">Results</p>
            <button id="modal-btn" class="w-full py-3 bg-accent text-black font-bold rounded hover:bg-green-400">Continue</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>